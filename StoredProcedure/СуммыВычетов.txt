CREATE PROCEDURE СуммыВычетов
@РаботникID INT,
@Дата DATETIME,
@Стандартные MONEY output,
@Социальные MONEY output,
@Имущественные MONEY output,
@Профессиональные MONEY output
AS

DECLARE @ВычетыРаботника table(
    Тип_вычета VARCHAR(150),
    Сумма MONEY);
    
INSERT INTO @ВычетыРаботника SELECT DISTINCT Налоговые_вычеты.Тип_вычета, Налоговые_вычеты.Сумма 
FROM Налоговый_вычет_работника, Налоговые_вычеты
WHERE (Налоговый_вычет_работника.работникID = @РаботникID) AND (Налоговый_вычет_работника.DEL = 0)
AND (Налоговые_вычеты.DEL = 0) AND(Налоговые_вычеты.Период_Начало < @Дата) AND (Налоговые_вычеты.Период_Конец > @Дата)
AND (Налоговый_вычет_работника.Код_вычета = Налоговые_вычеты.Код_вычета);

SET @Стандартные = (SELECT SUM(Сумма) FROM @ВычетыРаботника WHERE UPPER(Тип_вычета) like UPPER('%Стандартн%'));
SET @Социальные = (SELECT SUM(Сумма) FROM @ВычетыРаботника WHERE UPPER(Тип_вычета) like UPPER('%Социальн%'));
SET @Имущественные = (SELECT SUM(Сумма) FROM @ВычетыРаботника WHERE UPPER(Тип_вычета) like UPPER('%Имуществ%'));
SET @Профессиональные = (SELECT SUM(Сумма) FROM @ВычетыРаботника WHERE UPPER(Тип_вычета) like UPPER('%Профессион%'));